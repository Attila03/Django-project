{% extends 'ordersite/base.html' %}

{% load static %}

{% block customcss %}
    <link rel="stylesheet" type="text/css" href="{% static 'css/basic.css' %}"/>
    <link rel="stylesheet" type="text/css" href="{% static 'css/menu.css' %}"/>
{% endblock customcss %}

{% block con %}

{% if not user.is_authenticated %}
<p class="text-center"; style="font-size: larger"><a href="{% url 'Login' %}">Please Login to Order.</a></p>
{% endif %}

<!--CART BUTTON-->
{% if user.is_authenticated %}
<div class="container-fluid" id="cartbutton">
    <div class="row">
        <div class="col-xs-11 col-xs-offset-1 text-center">
            <div class="row">
                <div class="col-xs-3 col-xs-offset-9">
                    <button class="hide-cart btn btn-success">SHOW/HIDE CART</button>
                </div>
            </div>
        </div>
    </div>
</div>
<!--END CART BUTTON-->

<br>

{% endif %}

<!--CART-->
{% if request.session.cart.base or request.session.cart.custom %}
<div class="container-fluid" id="cart">
    <div class="row">
        <div class="col-xs-11 col-xs-offset-1">
            <div class="row">
            <div class="col-xs-3 col-xs-offset-9 cart">
                <table class="table table-hover table-condensed table-responsive">
                    <thead>
                    <tr class="info">
                        <th class="text-center" width="60%;"> Pizza</th>
                        <th width="60%;">Quantity</th>
                        <th>Cost</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% if request.session.cart.base %}
                    {% for id, pizza in request.session.cart.base.items %}
                    <tr class="{% if pizza.veg %}success{% else %}danger{% endif %}">
                        <td>{{pizza.name}}</td>
                        <td width="60%;">
                            <button type="button" class="btn btn-xs cart-sub {{id}}">-</button>
                             <span class="pizza-count">{{pizza.count}}</span>
                            <button type="button" class="btn btn-xs cart-add {{id}}">+</button>
                        </td>
                        <td class="text-center">
                            {{pizza.cost}}
                            <button type="button" class="btn btn-xs btn-primary center-block cart-remove {{id}}" title="remove form cart">x</button>
                        </td>
                    </tr>
                    {% endfor %}
                    {% endif %}
                    {% if request.session.cart.custom.items %}
                    {% for id,pizza in request.session.cart.custom.items %}
                    <tr class="{% if pizza.veg %}success{% else %}danger{% endif %}">
                        <td>{{pizza.name}}</td>
                        <td width="60%">
                            <button type="button" class="btn btn-xs cart-sub {{id}}">-</button>
                            <span class="pizza-count">{{pizza.count}}</span>
                            <button type="button" class="btn btn-xs cart-add {{id}}">+</button>
                        </td>
                        <td>
                            {{pizza.cost}}
                            <button type="button" class="btn btn-xs btn-primary center-block cart-remove {{id}}" title="Remove form cart">x</button>
                        </td>
                    </tr>
                    {% endfor %}
                    {% endif %}
                    </tbody>
                    <tfoot>
                    <tr class="info text-center">
                        <td>TOTAL</td>
                        <td></td>
                        <td>{{request.session.cart.total}}</td>
                    </tr>
                    </tfoot>
                </table>
                <a href="{% url 'Order' %}" class="btn btn-warning center-block">Place Order</a>
            </div>
            </div>
        </div>
    </div>
</div>
{% endif %}
<!--END CART-->

<!--MENU-->
<div class="container" id="menu">
    <div class="row">
        <div class="col-xs-10">
            <h2 class="text-center">MENU</h2>
            </br>
            <div class="row">
                {% for pizza in pizza_qs %}
                <div class="col-sm-4 col-x-6 text-center" style="position:relative;">
                    <img class="center-block" src="{% static pizza.getimageurl %}">
                    <h5>{{ pizza.name }}</h5>
                    <ul>
                        {% for topping in pizza.toppings.all %}
                        <li>{{ topping.name }}</li>
                        {% endfor %}
                        <li>Price: Rs. {{pizza.cost}}</li>
                    </ul>
                    <button type="button" class="btn btn-danger menu-add-cart" id="{{pizza.id}}">Add to cart</button>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>


{% endblock con %}


{% block js %}
<script type="text/javascript">
    $(document).ready(function () {
        //add-to-cart buttons
        $('.menu-add-cart').click(function(){
            var pizza = this.id;
            $.ajax({
                type : 'GET',
                url: "{% url 'AddToCart' %}",
                data: {
                    'pizza' : pizza,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                }
            }).done(function(data){
                $('#cart').load(location.href + ' #cart');
            });
        });
    });

    $(document).ready(function () {
        $('.hide-cart').click(function(){
            $('.cart').toggle(400);
        });
    });

    //add-subtract-remove buttons on the cart
    $(document).on('click', '.cart-add', function() {
        var classes = $(this).attr('class');
        $.ajax({
            type: 'GET',
            url: "{% url 'Add_sub_remove_cart' %}",
            data: {
                'classes': classes,
            },
            success: function (data) {
                $('#cart').load(location.href + ' #cart');
            }
        });
    });

    $(document).on('click', '.cart-sub', function(){
        var classes = $(this).attr('class');
        $.ajax({
           type: 'GET',
            url: "{% url 'Add_sub_remove_cart' %}",
            data: {
                'classes': classes
            },
            success: function(data){
                $('#cart').load(location.href + ' #cart');
            }
        });
    });

    $(document).on('click', '.cart-remove', function(){
        var classes = $(this).attr('class');
        $.ajax({
           type: 'GET',
            url: "{% url 'Add_sub_remove_cart' %}",
            data: {
                'classes': classes
            },
            success: function(data){
                $('#cart').load(location.href + ' #cart');
            }
        });
    })

</script>

{% endblock js %}

